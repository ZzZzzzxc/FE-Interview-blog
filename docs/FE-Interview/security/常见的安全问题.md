# 常见的安全问题

## XSS

跨站脚本（Cross Site Scripting），简称 XSS 攻击，是指在浏览器中执行了一段恶意脚本，使用户信息被泄露，从而导致后续的恶意操作。

XSS 攻击通常有三种方式，存储型、反射型和文档型。

### 存储型

存储型指恶意脚本被存储到了数据库中，然后在每个用户访问特定页面的时候执行这些脚本完成攻击。

比如：在评论区提交一段恶意脚本，如果前后端没有做好转译的工作，就会造成脚本被存储到服务器中，然后每次该页面渲染的时候都会执行该脚本。

### 反射型

反射型指在网络请求中拼接一段恶意脚本，如果拼接的脚本内容被前端作为 HTML 直接解析到页面中，就会造成恶意脚本的执行。

比如：在一个搜索框中，搜索`<script>alert("XSS")</script>`，这样就会发送 `https://interview.zhangxc.cn?q=<script>alert("XSS")</script>` 请求给后端，前端最后可能会在页面中提示 `<script>alert("XSS")</script>` 的搜索结果不存在，这样就无意中执行了一段恶意脚本，
恶意脚本就完成了从前端到后端，最后再反射到 HTML 文档中的工作。

### 文档型

文档型的 XSS 攻击并不会经过服务端，而是作为中间人的角色，在数据传输过程劫持到网络数据包，然后修改里面的 HTML 文档。

### XSS 的防范

- 输入的转译和过滤：永远不要相信用户的输入。
- 内容安全策略（CSP）：通过 `Content-Security-Policy` 响应头和 `<meta>` 标签配置该策略，指定浏览器应该加载哪些资源。
- HttpOnly：对 cookie 设置 `HttpOnly` 属性，避免 JavaScript 脚本直接去读取 cookie，从而避免一些场景下的攻击。

## CSRF

跨站请求伪造（Cross-site request forgery），简称 CSRF，指的是攻击者诱导用户点击某些恶意链接，然后利用用户当前的账户登录状态发起跨站请求。

### 自动发送请求

用户访问的站点中存在恶意脚本，比如页面中存在这种 `<img src="https://xxx.com/info?user=hhh&count=100"></img>` 节点，进入页面后客户端会自动携带 `xxx.com` 的 cookie 去进行请求，导致一些意外操作的发送。

### 诱导发送请求

在页面中留下恶意的超链接诱导用户进行点击，从而发生上述的情况。

### CSRF 的防范

- SameSite：在 cookie 中设置 `SameSite` 属性，对跨站携带 cookie 的行为做出限制。
- CSRF Token：服务端生成一个 Token 存储在 HTML 文档中，然后在请求的时候要求用户携带一个由服务端生成的 Token，服务端在收到 Token 之后进行解密验证 Token 的正确性。
